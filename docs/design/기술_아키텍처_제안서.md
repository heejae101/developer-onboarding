# [ê¸°ìˆ  ì œì•ˆ] Hybrid AI Onboarding Architecture v2.0

## 1. ê°œìš” (Overview)
ë³¸ ë¬¸ì„œëŠ” ì‹ ë¬´ Java í™˜ê²½ê³¼ ìµœì‹  AI ìƒíƒœê³„(LangGraph + Ollama)ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í†µí•©í•˜ê¸° ìœ„í•œ ê¸°ìˆ  ì•„í‚¤í…ì²˜ ì œì•ˆì„œì…ë‹ˆë‹¤. **v2.0**ì—ì„œëŠ” ë¡œì»¬ LLM, ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°, ë³‘ë ¬ ì—ì´ì „íŠ¸ êµ¬ì¡°ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.

---

## 2. í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ (Updated)

| ë ˆì´ì–´ | ê¸°ìˆ  | ì—­í•  |
|:---|:---|:---|
| **Frontend** | React 18 + Vite 5 | ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤, WebSocket í´ë¼ì´ì–¸íŠ¸ |
| **Main Backend** | Spring Boot 3.2 + Java 17 | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, Thread Pool, Request Queue, WebSocket ì„œë²„ |
| **AI Agent Layer** | FastAPI + LangGraph | ì§€ëŠ¥í˜• ë¼ìš°íŒ…, ììœ¨ ì—ì´ì „íŠ¸ ë£¨í”„ |
| **LLM Engine** | **API ëª¨ë“œ (ì´ˆê¸°)**: OpenAI/Anthropic API | ì•ˆì •ì ì¸ ì´ˆê¸° ê°œë°œ ë° ê²€ì¦ |
| | **ë¡œì»¬ ëª¨ë“œ (ê³ ë„í™”)**: Ollama (ë§¥ë¶ ì‚¬ì–‘ ìµœì í™”) | ë¹„ìš© ì ˆê°, ì˜¤í”„ë¼ì¸ ì§€ì› |
| **ë³‘ë ¬ ì‹¤í–‰** | Git Worktree | ë‹¤ì¤‘ ì—ì´ì „íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ë³‘ë ¬ ì‹¤í–‰ |
| **Database** | PostgreSQL + Redis | ë©”ì¸ ë°ì´í„° + ìºì‹±/ì„¸ì…˜/í |

> [!TIP] LLM ëª¨ë“œ ì „í™˜ ì „ëµ
> - **Phase 1 (MVP)**: OpenAI APIë¡œ ë¹ ë¥´ê²Œ ê²€ì¦
> - **Phase 2 (ì•ˆì •í™”)**: Ollama + ë§¥ë¶ ìµœì í™” ëª¨ë¸ (ì˜ˆ: Llama3-8B, Phi-3)
> - í™˜ê²½ ë³€ìˆ˜ `LLM_MODE=api|local`ë¡œ ëŸ°íƒ€ì„ ìŠ¤ìœ„ì¹­ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„

---

## 3. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (Diagram)

```mermaid
graph TD
    subgraph "Client Layer"
        A[React/Vite]
        A1[WebSocket Client]
    end
    
    subgraph "Spring Boot Backend"
        B[REST Controller]
        B1[WebSocket Handler]
        B2[Thread Pool Executor]
        B3[Request Queue]
    end
    
    subgraph "AI Agent Layer - FastAPI"
        C[FastAPI Server]
        C1[LangGraph Engine]
        C2[Agent State Manager]
        C3[Autonomous Loop Controller]
    end
    
    subgraph "LLM Layer"
        D[Ollama - Local LLM]
    end
    
    subgraph "Parallel Execution"
        E1[Worktree Agent 1]
        E2[Worktree Agent 2]
        E3[Worktree Agent N]
    end
    
    A <--> B
    A1 <-.WebSocket.-> B1
    B --> B2
    B2 --> B3
    B3 --> C
    C --> C1
    C1 --> C2
    C1 --> C3
    C3 --> D
    C3 --> E1
    C3 --> E2
    C3 --> E3
    E1 --> D
    E2 --> D
    E3 --> D
```

---

## 4. í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ìƒì„¸

### 4.1 Spring Boot: Thread Pool & Request Queue

> [!TIP] í•™ìŠµ í¬ì¸íŠ¸
> ì‹¤ë¬´ì—ì„œ ìì£¼ ë§ˆì£¼ì¹˜ëŠ” ë™ì‹œì„± ì²˜ë¦¬ì™€ ë¹„ë™ê¸° ìš”ì²­ ê´€ë¦¬ë¥¼ ì§ì ‘ êµ¬í˜„í•´ë´…ë‹ˆë‹¤.

```java
// ThreadPoolConfig.java ì˜ˆì‹œ
@Configuration
public class ThreadPoolConfig {
    @Bean
    public ThreadPoolTaskExecutor aiTaskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(100);
        executor.setThreadNamePrefix("AI-Agent-");
        executor.setRejectedExecutionHandler(new CallerRunsPolicy());
        return executor;
    }
}
```

- **Thread Pool**: AI ìš”ì²­ì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ì—¬ ì‘ë‹µ ì†ë„ í–¥ìƒ
- **Request Queue**: í­ì£¼í•˜ëŠ” ìš”ì²­ì„ ë²„í¼ë§í•˜ì—¬ ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´
- **Rejected Handler**: íê°€ ê°€ë“ ì°¼ì„ ë•Œì˜ Fallback ì „ëµ í•™ìŠµ

### 4.2 WebSocket: ì‹¤ì‹œê°„ AI ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°

```java
// WebSocketConfig.java ì˜ˆì‹œ
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(aiStreamHandler(), "/ws/ai-stream")
                .setAllowedOrigins("*");
    }
}
```

- **ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ**: Ollamaì˜ í† í° ë‹¨ìœ„ ì¶œë ¥ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬
- **ì—°ê²° ê´€ë¦¬**: ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€

### 4.3 FastAPI + LangGraph: ììœ¨ ì—ì´ì „íŠ¸ ë£¨í”„

```python
# agent_loop.py ì˜ˆì‹œ
from langgraph.graph import StateGraph
import ollama

class AutonomousAgent:
    def __init__(self):
        self.graph = self._build_graph()
        self.ollama = ollama.Client()
    
    def _build_graph(self) -> StateGraph:
        # LangGraph ë…¸ë“œ êµ¬ì„±
        graph = StateGraph(AgentState)
        graph.add_node("think", self.think_node)
        graph.add_node("act", self.act_node)
        graph.add_node("observe", self.observe_node)
        graph.add_conditional_edges("observe", self.should_continue)
        return graph.compile()
    
    async def run_loop(self, initial_task: str):
        """ììœ¨ì ìœ¼ë¡œ ê³„ì† ì‹¤í–‰í•˜ëŠ” ì—ì´ì „íŠ¸ ë£¨í”„"""
        state = {"task": initial_task, "steps": []}
        while not state.get("done"):
            state = await self.graph.ainvoke(state)
        return state
```

- **Think-Act-Observe ë£¨í”„**: ì—ì´ì „íŠ¸ê°€ ìŠ¤ìŠ¤ë¡œ ê³„íší•˜ê³  ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ê´€ì°°
- **Ollama ë„¤ì´í‹°ë¸Œ**: ì™¸ë¶€ API ì—†ì´ ë¡œì»¬ì—ì„œ ì¶”ë¡ 

### 4.4 Git Worktree: ë³‘ë ¬ ì—ì´ì „íŠ¸ ì‹¤í–‰

```bash
# ë³‘ë ¬ ì—ì´ì „íŠ¸ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ
#!/bin/bash
PROJECT_ROOT=$(pwd)

# ê° ì—ì´ì „íŠ¸ë¥¼ ë³„ë„ì˜ worktreeì—ì„œ ì‹¤í–‰
git worktree add ../agent-worker-1 main
git worktree add ../agent-worker-2 main

# ë³‘ë ¬ ì‹¤í–‰
cd ../agent-worker-1 && python agent.py --task="code-review" &
cd ../agent-worker-2 && python agent.py --task="doc-generation" &

wait
```

> [!IMPORTANT] Git Worktreeì˜ ì¥ì 
> - ë™ì¼ ì €ì¥ì†Œì—ì„œ ì—¬ëŸ¬ ë¸Œëœì¹˜/ì‘ì—…ì„ ë™ì‹œì— ì‹¤í–‰ ê°€ëŠ¥
> - ì—ì´ì „íŠ¸ ê°„ íŒŒì¼ ì¶©ëŒ ì—†ì´ ë…ë¦½ì ì¸ ì‘ì—… ê³µê°„ í™•ë³´
> - CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œë„ í™œìš© ê°€ëŠ¥

---

## 5. ê¸°ìˆ  ì„ íƒ ê·¼ê±° (Justification)

### ğŸš© ì˜¤ë²„ ì—”ì§€ë‹ˆì–´ë§ ë°©ì§€
1. **Ollama ë¡œì»¬ ì‹¤í–‰**: ì™¸ë¶€ API ë¹„ìš©ê³¼ ë ˆì´í„´ì‹œ ì œê±°, ë³´ì•ˆ ê°•í™”
2. **Git Worktree**: ë³µì¡í•œ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ëŒ€ì‹  ê°€ë²¼ìš´ ë³‘ë ¬í™” êµ¬í˜„
3. **Spring ë‚´ì¥ ê¸°ëŠ¥ í™œìš©**: ì™¸ë¶€ ë©”ì‹œì§€ í(Kafka ë“±) ëŒ€ì‹  ë‚´ì¥ Thread Pool/Queueë¡œ ì‹¬í”Œí•˜ê²Œ ì‹œì‘

### ğŸš© ì‹¤ë¬´ í•™ìŠµ ì í•©ì„±
1. **Thread Pool/Queue**: ë©´ì ‘ì—ì„œ ìì£¼ ë‚˜ì˜¤ëŠ” ë™ì‹œì„± ì²˜ë¦¬ í•µì‹¬ ê°œë… ì‹¤ìŠµ
2. **WebSocket**: ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ ê°œë°œ ê²½í—˜ í™•ë³´
3. **LangGraph**: ìµœì‹  ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜ í•™ìŠµ

---

## 6. ê¸°ëŒ€ íš¨ê³¼
- **ì‹ ì… ì‚¬ì› ì…ì¥**: ì‹¤ì œ Java í™˜ê²½ì—ì„œ AI ê°€ì´ë“œë¥¼ ë°›ìœ¼ë©° ì‹¤ìŠµ, ë™ì‹œì— ìµœì‹  AI ì—ì´ì „íŠ¸ êµ¬ì¡° í•™ìŠµ
- **ê°œë°œì ì…ì¥**: ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ êµ¬ì¡°ì—ì„œ ë¡œì»¬ LLM ê¸°ë°˜ ì§€ëŠ¥í˜• ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ëŠ¥
- **ì‹œìŠ¤í…œ ê´€ì **: ì™¸ë¶€ ì˜ì¡´ì„± ìµœì†Œí™”ë¡œ ì•ˆì •ì ì´ê³  ë¹„ìš© íš¨ìœ¨ì ì¸ ìš´ì˜
