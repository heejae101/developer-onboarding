# [상세 설계] 보안 및 권한 설계

## 1. 보안 원칙
- **최소 권한의 원칙**: AI 에이전트와 MCP 서버는 사전에 허용된 디렉토리와 API에만 접근 가능해야 함.
- **데이터 격리**: 사용자별 업무 기록 및 실습 이력은 타인에게 노출되지 않도록 서버 측에서 검증.

---

## 2. 사용자 권한 체계 (RBAC)

| 역할 (Role) | 주요 권한 | 비고 |
| :--- | :--- | :--- |
| **신입 사원** | 가이드 조회, 실습 수행, 본인 업무 기록 관리 | 가장 기본적인 권한 |
| **시니어/관리자** | 프로젝트 룰(`rules.md`) 수정, 팀원 진행 상황 리뷰 | 관리 포인트 접근 허용 |
| **AI 에이전트** | 프로젝트 룰 읽기, 허용된 도구 실행, 알림 발송 | MCP를 통해 위임된 권한만 수행 |

---

## 3. MCP 보안 설계 (Sandboxing)
- **파일 시스템**: 에이전트는 `/workspace/onboarding` 하위 디렉토리만 읽기/쓰기 가능.
- **인증**: Java Backend가 Python MCP 서버에 접근할 때 인증 토큰(API Key) 기반 통신 수행.

---

## 4. API 보안
- **JWT 인증**: 모든 프런트엔드 요청은 JWT 토큰을 포함해야 함.
- **Input Validation**: LLM에 전달되기 전, 악의적인 프롬프트(Prompt Injection)를 방지하기 위한 필터링 레이어 구축.

---

## 5. LLM 보안 기본 (프롬프트 인젝션 대응)

프롬프트 인젝션은 LLM이 정책과 의도를 벗어난 행동을 하도록 유도하는 공격이다. 완전한 차단은 어렵기 때문에 다층 방어, 권한 통제, 인간 승인 체계를 기본으로 한다.

### 5.1 기본 방어 원칙
- **입력 검증**: LLM 전달 전 입력 길이 제한, 위험 패턴 필터링, 구조 검증을 적용한다.
- **역할 분리**: 시스템 지침과 사용자 입력을 명확히 분리하고, 사용자 입력을 시스템 프롬프트에 직접 합치지 않는다.
- **출력 검증**: 민감 정보, 명령/링크 생성 여부를 검사하고 이상 패턴을 모니터링한다.
- **최소 권한**: LLM과 도구 권한을 최소화하고, 고위험 작업은 승인 단계를 둔다.
- **다층 방어**: 단일 방어책에 의존하지 않고 입력/출력/권한/모니터링을 동시에 적용한다.

### 5.2 운영 체크리스트
- 시스템 프롬프트에 민감 정보(API 키, 내부 규칙 원문)를 직접 포함하지 않는다.
- 결제, 삭제, 외부 전송 등 고위험 작업은 인간 승인 후 실행한다.
- RAG 문서와 외부 입력은 신뢰 경계를 분리하고, 악성 지시로 처리하지 않도록 표시/정책을 둔다.
